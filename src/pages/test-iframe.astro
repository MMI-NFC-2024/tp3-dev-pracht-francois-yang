---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <h1 class="text-2xl">Test iframe</h1>
  <select id="menu" class="border p-2 rounded mb-4">
    <option value="">-- Choisir un mode --</option>
    <option value="iframe">Voir les manchots en iframe</option>
    <option value="ancre">Voir les manchots avec des ancres</option>
    <option value="tabs">Voir les manchots en onglets</option>
  </select>
  <p>Choisir une espèce de manchot :</p>
 <select id="species">
   <option value="Adelie">Adelie</option>
   <option value="Chinstrap">Chinstrap</option>
   <option value="Gentoo">Gentoo</option>
 </select>
 <script>
   // Menu mode (iframe/ancre/tabs)
   const selectMenu = document.querySelector("#menu") as HTMLSelectElement;
   if (selectMenu) {
     if (window.location.pathname.includes("test-iframe")) {
       selectMenu.value = "iframe";
     } else if (window.location.pathname.includes("ancres")) {
       selectMenu.value = "ancre";
     } else if (window.location.pathname.includes("tabs")) {
       selectMenu.value = "tabs";
     } else {
       selectMenu.value = "";
     }
     selectMenu.addEventListener("change", () => {
       const value = selectMenu.value;
       if (value === "iframe") {
         window.location.pathname = "/test-iframe";
       } else if (value === "ancre") {
         window.location.pathname = "/ancres";
       } else if (value === "tabs") {
         window.location.pathname = "/tabs";
       }
     });
   }
   // Menu espèce (iframe)
   const select = document.querySelector("#species") as HTMLSelectElement;
   const iframe = document.getElementById("iframeMain") as HTMLIFrameElement;
   if (select && iframe) {
     const current = iframe.src.split("/species/")[1];
     if (current) select.value = current;
     select.addEventListener("change", () => {
       const value = select.value;
       iframe.src = "/species/" + value;
     });
     select.addEventListener("click", () => {
       const value = select.value;
       iframe.src = "/species/" + value;
     });
   }
 </script>
  <iframe
    name="iframeMain"
    id="iframeMain"
    src="/species/Adelie"
    style="height: 510px;"
    class="w-full border-2 border-black mb-4"
    title="Iframe principale"
    onload="frame(this)"
  ></iframe>
  <script>
    function frame(iframe: HTMLIFrameElement) {
      try {
        if (iframe.contentWindow.document.body) {
          iframe.style.height = iframe.contentWindow.document.body.scrollHeight + 'px';
        }
      } catch (e) {
        // Cross-origin protection
        iframe.style.height = '510px';
      }
    }
  </script>
</Layout>
