---
import Layout from "../layouts/Layout.astro";
import PlotFigure from "../components/PlotFigure.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";
---

<Layout>
  <h1 class="text-2xl mb-4">Tabs de graphiques Penguins</h1>
  <select id="menu" class="border p-2 rounded mb-4">
    <option value="">-- Choisir un mode --</option>
    <option value="iframe">Voir les manchots en iframe</option>
    <option value="ancre">Voir les manchots avec des ancres</option>
    <option value="tabs">Voir les manchots en onglets</option>
  </select>
  <p>Choisir une espèce de manchot :</p>
  <select id="species">
    <option value="Adelie">Adelie</option>
    <option value="Chinstrap">Chinstrap</option>
    <option value="Gentoo">Gentoo</option>
  </select>
  <script>
    // Menu mode (iframe/ancre/tabs)
    const selectMenu = document.querySelector("#menu") as HTMLSelectElement;
    if (selectMenu) {
      if (window.location.pathname.includes("test-iframe")) {
        selectMenu.value = "iframe";
      } else if (window.location.pathname.includes("ancres")) {
        selectMenu.value = "ancre";
      } else if (window.location.pathname.includes("tabs")) {
        selectMenu.value = "tabs";
      } else {
        selectMenu.value = "";
      }
      selectMenu.addEventListener("change", () => {
        const value = selectMenu.value;
        if (value === "iframe") {
          window.location.pathname = "/test-iframe";
        } else if (value === "ancre") {
          window.location.pathname = "/ancres";
        } else if (value === "tabs") {
          window.location.pathname = "/tabs";
        }
      });
    }
    // Menu espèce (tabs)
    const select = document.querySelector("#species") as HTMLSelectElement;
    if (select) {
      // Synchronise le select avec l'onglet courant
      const hash = window.location.hash.replace('#tab-', '');
      if (["Adelie", "Chinstrap", "Gentoo"].includes(hash)) {
        select.value = hash;
      }
      select.addEventListener("change", () => {
        const value = select.value;
        location.hash = "#tab-" + value;
      });
    }
  </script>
  <div>
    <astro-tabs>
      <astro-tab label="Adelie" id="tab-Adelie" selected>
        <section>
          <h2 class="text-xl mb-2">Adelie</h2>
          <PlotFigure options={{marks: [
            Plot.dot(penguins.filter(({species})=>species==="Adelie"), {
              x: "culmen_length_mm",
              y: "culmen_depth_mm",
              stroke: "species",
            }),
          ],}} />
        </section>
      </astro-tab>
      <astro-tab label="Chinstrap" id="tab-Chinstrap">
        <section>
          <h2 class="text-xl mb-2">Chinstrap</h2>
          <PlotFigure options={{marks: [
            Plot.dot(penguins.filter(({species})=>species==="Chinstrap"), {
              x: "culmen_length_mm",
              y: "culmen_depth_mm",
              stroke: "species",
            }),
          ],}} />
        </section>
      </astro-tab>
      <astro-tab label="Gentoo" id="tab-Gentoo">
        <section>
          <h2 class="text-xl mb-2">Gentoo</h2>
          <PlotFigure options={{marks: [
            Plot.dot(penguins.filter(({species})=>species==="Gentoo"), {
              x: "culmen_length_mm",
              y: "culmen_depth_mm",
              stroke: "species",
            }),
          ],}} />
        </section>
      </astro-tab>
    </astro-tabs>
  </div>
</Layout>
